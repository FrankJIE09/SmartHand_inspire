# 灵巧手控制系统

## 项目简介

本项目旨在构建一个灵巧手（机器人手）-因时机器人的控制系统，主要包括以下功能：

- **手势控制**：基于 MediaPipe 实现，通过摄像头捕捉用户手势，计算手部关节角度，并将这些角度经过平滑滤波后转换为机器人手的控制指令，通过 Modbus TCP 通信发送给设备。
- **键盘控制**：利用键盘输入实现对机器人手各自由度角度的实时调节，支持增减角度操作。
- **触觉数据展示**：实时读取各手指（指端、指尖、指腹）的触觉传感器数据，并以 5×3 的矩阵形式图形化展示平均值，便于调试和数据监控。

## 项目结构

- **smart_hand_controller.py**  
  封装了与机器人手的 Modbus TCP 通信接口，提供了读取/写入寄存器、设置/获取角度、获取触觉数据及分段数据的功能。

- **mediapipe_hand_control.py**  
  利用 MediaPipe 手部检测捕捉用户手势，计算各关键点之间的角度，并将这些角度通过映射函数转换为机器人手控制指令。内置了 EMA 平滑滤波，确保控制指令平稳。

- **run_keyboard_control.py**  
  通过 pynput 监听键盘按键，根据预设的按键映射（q, w, e, r, t, y 对应增大，a, s, d, f, g, h 对应减小）调整机器人手的各个自由度角度，实现手动控制。

- **display_palm.py**  
  读取机器人手各手指触觉传感器数据，并计算每个手指不同分段（指端、指尖、指腹）的平均值，实时以热力图形式展示数据变化。

## 环境依赖

请确保已安装以下 Python 库（建议使用 Python 3.x）：

- numpy
- matplotlib
- opencv-python
- mediapipe
- pymodbus
- pynput

你可以使用 pip 进行安装，例如：

```bash
pip install numpy matplotlib opencv-python mediapipe pymodbus pynput
```

## 配置说明

- **IP 地址和端口**  
  默认设备 IP 为 `192.168.11.210`，端口号为 `6000`，请根据实际设备情况在代码中（如 `smart_hand_controller.py`、`mediapipe_hand_control.py`）进行修改。

- **角度映射**  
  项目中将人手关节角度映射到机器人手的控制范围（0~1000），具体映射关系在代码中有详细说明，可根据实际测试结果调整映射参数。

- **摄像头索引**  
  默认摄像头索引为 `0`（即系统默认摄像头），如需使用其他摄像头，请修改 `mediapipe_hand_control.py` 中的 `CAMERA_INDEX` 参数。

## 使用方法

### 1. 触觉数据展示

运行 `display_palm.py`，实时获取并展示每个手指各分段的触觉数据平均值，数据以 5×3 矩阵热力图的形式显示：

```bash
python display_palm.py
```

### 2. 手势控制

运行 `mediapipe_hand_control.py`，通过摄像头捕捉手势，实现对机器人手的自动控制：

```bash
python mediapipe_hand_control.py
```

- 程序中会显示当前滤波后的目标角度和原始计算角度，方便调试；
- 按 `q` 键退出程序。

### 3. 键盘控制

运行 `run_keyboard_control.py`，通过键盘按键实时调整机器人手的各自由度角度：

```bash
python run_keyboard_control.py
```

- **增加角度**：按键 `q, w, e, r, t, y` 分别对应自由度 5、4、3、2、1、0 的角度增加；
- **减少角度**：按键 `a, s, d, f, g, h` 分别对应自由度 5、4、3、2、1、0 的角度减少；
- 按 `ESC` 键退出程序。

## 注意事项

- **设备连接**：请确保机器人手设备已正确连接，网络通信正常，且设备 IP 与端口配置正确。
- **摄像头驱动**：在使用手势控制前，请确保摄像头驱动安装正常，并可被 OpenCV 打开。
- **角度映射调试**：建议在实际使用前，先调试人手角度与机器人手控制值之间的映射关系，确保操作安全且符合实际需求。

## 许可证

MIT license

## 联系方式

如有问题或建议，请联系项目开发者。
